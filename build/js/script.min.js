'use strict';

var slider = document.getElementById('slider');
var prev = slider.querySelector('.slider__button--prev');
var next = slider.querySelector('.slider__button--next');
var container = slider.querySelector('.slider__container');
var radioContainer = slider.querySelector('.slider__radio');
var radio = slider.getElementsByTagName('input');
var step = parseInt(getComputedStyle(slider).width);
var transition = 'transform .5s linear';
var pos = 0;
var shift = 0;
var allLength;
var radioArray = Array.from(radio);
radioArray.forEach(function (item) {
  return item.addEventListener('change', radioMove);
});

function createClone() {
  pos = -step;
  container.style.transform = "translateX(".concat(pos, "px)");
  var prevSlide = container.children[0].cloneNode(true);
  var nextSlide = container.children[container.children.length - 1].cloneNode(true);
  container.insertBefore(nextSlide, container.children[0]);
  container.appendChild(prevSlide);
  allLength = container.children.length;
}

createClone();

function radioMove(e) {
  resetAutoplay();

  if (this.checked) {
    shift = radioArray.indexOf(this);
    pos = (shift + 1) * -step;
    console.log(shift, pos);
    container.style.transform = "translateX(".concat(pos, "px)");
  }

  autoplay();
}

function movePrev() {
  if (!shift) {
    shift = radio.length - 1;
  } else {
    shift--;
  }

  if (!pos) {
    pos = -step * (allLength - 2);
    container.style.transition = 'null';
    container.style.transform = "translateX(".concat(pos, "px)");
  }

  requestAnimationFrame(function () {
    requestAnimationFrame(function () {
      container.style.transition = transition;
      pos += step;
      radio[shift].checked = true;
      container.style.transform = "translateX(".concat(pos, "px)");
      console.log("pos:".concat(pos, ", shift:").concat(shift));
    });
  });
}

function moveNext() {
  if (shift === radio.length - 1) {
    shift = 0;
  } else {
    shift++;
  }

  if (pos === -step * (allLength - 1)) {
    pos = -step;
    container.style.transition = 'null';
    container.style.transform = "translateX(".concat(pos, "px)");
  }

  requestAnimationFrame(function () {
    requestAnimationFrame(function () {
      container.style.transition = transition;
      pos -= step;
      radio[shift].checked = true;
      container.style.transform = "translateX(".concat(pos, "px)");
      console.log("pos:".concat(pos, ", shift:").concat(shift));
    });
  });
}

var timer;

function autoplay() {
  timer = setTimeout(function () {
    moveNext();
    autoplay();
  }, 4000);
}

autoplay();

function resetAutoplay() {
  clearTimeout(timer);
}

document.addEventListener('visibilitychange', function () {
  console.log('state:' + document.visibilityState);

  if (document.visibilityState === 'hidden') {
    resetAutoplay();
  } else {
    pos = -step;
    container.style.transition = '';
    container.style.transform = "translateX(".concat(pos, "px)");
    autoplay();
  }
});
prev.addEventListener('click', function () {
  resetAutoplay();
  movePrev();
  autoplay();
});
next.addEventListener('click', function () {
  resetAutoplay();
  moveNext();
  autoplay();
});